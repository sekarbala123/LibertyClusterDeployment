<server description="Liberty Collective Controller">

    <!-- Enable features -->
    <featureManager>
        <feature>collectiveController-1.0</feature>
        <feature>adminCenter-1.0</feature>
        <feature>restConnector-2.0</feature>
        <feature>javaee-8.0</feature>
        <feature>appSecurity-2.0</feature>
    </featureManager>

    <!-- HTTP endpoint -->
    <httpEndpoint id="defaultHttpEndpoint"
                  host="*"
                  httpPort="9080"
                  httpsPort="9443" />

    <!-- Define the host name for use by the collective. -->
    <variable name="defaultHostName" value="localhost" />

    <!-- Enhanced Security Configuration -->
    <!-- Using basicRegistry with password encryption (XOR encoding) -->
    <!-- For production, consider using LDAP or other enterprise user registry -->
    <basicRegistry id="basic" realm="CollectiveRealm">
        <!-- Password is encoded using securityUtility encode command -->
        <!-- Original password: admin123! (encoded with XOR) -->
        <user name="admin" password="{xor}Lz4sLCgwLTs=" />
        <!-- Additional admin user for redundancy -->
        <user name="controller-admin" password="{xor}Lz4sLCgwLTs=" />
    </basicRegistry>
    
    <!-- Administrator role for Admin Center and REST Connector -->
    <administrator-role>
        <user>admin</user>
        <user>controller-admin</user>
    </administrator-role>
    
    <!-- Authorization roles for application security -->
    <authorization-roles id="com.ibm.ws.management">
        <security-role name="Administrator">
            <user name="admin"/>
            <user name="controller-admin"/>
        </security-role>
        <security-role name="Reader">
            <user name="admin"/>
            <user name="controller-admin"/>
        </security-role>
    </authorization-roles>

    <!-- clientAuthenticationSupported set to enable bidirectional trust -->
    <ssl id="defaultSSLConfig"
         keyStoreRef="defaultKeyStore"
         trustStoreRef="defaultTrustStore"
         clientAuthenticationSupported="true" />

    <!-- inbound (HTTPS) keystore -->
    <keyStore id="defaultKeyStore" password="Liberty"
              location="${server.config.dir}/resources/security/key.p12" />

    <!-- inbound (HTTPS) truststore -->
    <keyStore id="defaultTrustStore" password="Liberty"
              location="${server.config.dir}/resources/security/trust.p12" />

    <!-- server identity keystore -->
    <keyStore id="serverIdentity" password="Liberty"
              location="${server.config.dir}/resources/collective/serverIdentity.p12" />

    <!-- collective trust keystore -->
    <keyStore id="collectiveTrust" password="Liberty"
              location="${server.config.dir}/resources/collective/collectiveTrust.p12" />

    <!-- collective root signers keystore -->
    <keyStore id="collectiveRootKeys" password="Liberty"
              location="${server.config.dir}/resources/collective/rootKeys.p12" />

    <!-- Remote file access for collective operations -->
    <remoteFileAccess>
        <readDir>${wlp.install.dir}</readDir>
        <readDir>${wlp.user.dir}</readDir>
        <readDir>${server.output.dir}</readDir>
        <readDir>${server.config.dir}</readDir>
        <writeDir>${server.config.dir}</writeDir>
        <writeDir>${server.output.dir}</writeDir>
    </remoteFileAccess>

    <!-- Deploy the EAR -->
    <enterpriseApplication location="liberty-cluster-app-ear-1.0-SNAPSHOT.ear"/>

</server>
